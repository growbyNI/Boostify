<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Boostify Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, get, set, push, update } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyALsHqqsteKQSp5lFtUXsaLASE8QBeejsM",
      authDomain: "motion-f3e7b.firebaseapp.com",
      databaseURL: "https://motion-f3e7b-default-rtdb.firebaseio.com",
      projectId: "motion-f3e7b",
      storageBucket: "motion-f3e7b.firebasestorage.app",
      messagingSenderId: "39637220542",
      appId: "1:39637220542:web:2c1ecea0737f8f617af2ef"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const user = JSON.parse(localStorage.getItem("boostifyUser"));
    if (!user) window.location.href = "login.html";

    let balance = 0;
    let points = 0;

    async function loadDashboard() {
      document.getElementById("username").innerText = user.name;

      // Load balance
      const balanceRef = ref(db, "users/" + user.uid + "/balance");
      const snapshot = await get(balanceRef);
      balance = snapshot.exists() ? snapshot.val() : 0;
      document.getElementById("balance").innerText = balance.toFixed(2);

      // Load points
      const pointsRef = ref(db, "users/" + user.uid + "/points");
      const pointsSnap = await get(pointsRef);
      points = pointsSnap.exists() ? pointsSnap.val() : 0;
      document.getElementById("points").innerText = points;

      loadCampaigns();
      loadFreeCampaigns();
    }

    async function depositFunds() {
      const amount = parseFloat(document.getElementById("depositAmount").value);
      if (isNaN(amount) || amount <= 0) {
        alert("Enter a valid amount");
        return;
      }
      balance += amount;
      await set(ref(db, "users/" + user.uid + "/balance"), balance);
      document.getElementById("balance").innerText = balance.toFixed(2);
      document.getElementById("depositAmount").value = "";
      alert("Deposit successful!");
    }

    async function createCampaign() {
      const name = document.getElementById("campaignName").value.trim();
      const url = document.getElementById("campaignUrl").value.trim();
      const budget = parseFloat(document.getElementById("campaignBudget").value);

      if (!name || !url || isNaN(budget) || budget <= 0) {
        alert("Fill in all fields with valid values");
        return;
      }

      if (budget > balance) {
        alert("Insufficient balance. Please deposit funds.");
        return;
      }

      const campaign = {
        name,
        url,
        budget,
        spent: 0,
        status: "Pending",
        createdAt: new Date().toISOString()
      };

      const campaignRef = push(ref(db, "users/" + user.uid + "/campaigns"));
      await set(campaignRef, campaign);

      alert("Campaign created successfully!");
      document.getElementById("campaignName").value = "";
      document.getElementById("campaignUrl").value = "";
      document.getElementById("campaignBudget").value = "";

      loadCampaigns();
    }

    async function loadCampaigns() {
      const campaignsRef = ref(db, "users/" + user.uid + "/campaigns");
      const snapshot = await get(campaignsRef);
      const table = document.getElementById("campaignTable");
      table.innerHTML = "";

      if (!snapshot.exists()) {
        table.innerHTML = "<tr><td colspan='5' class='text-center py-4 text-gray-400'>No campaigns yet.</td></tr>";
        return;
      }

      const campaigns = snapshot.val();
      for (const key in campaigns) {
        const c = campaigns[key];
        const row = document.createElement("tr");
        row.className = "border-b border-gray-700";
        row.innerHTML = `
          <td class="py-2 px-4">${c.name}</td>
          <td class="py-2 px-4">${c.url}</td>
          <td class="py-2 px-4">$${c.budget.toFixed(2)}</td>
          <td class="py-2 px-4">${c.status}</td>
          <td class="py-2 px-4">
            <button onclick="updateStatus('${key}', 'Active')" class="px-2 py-1 bg-green-500 rounded">Activate</button>
            <button onclick="updateStatus('${key}', 'Paused')" class="px-2 py-1 bg-yellow-500 rounded">Pause</button>
            <button onclick="updateStatus('${key}', 'Completed')" class="px-2 py-1 bg-gray-500 rounded">Complete</button>
          </td>
        `;
        table.appendChild(row);
      }
    }

    async function createFreeCampaign() {
  const name = document.getElementById("freeCampaignName").value.trim();
  const url = document.getElementById("freeCampaignUrl").value.trim();
  const campaignPoints = parseFloat(document.getElementById("freeCampaignPoints").value);

  if (!name || !url || isNaN(campaignPoints) || campaignPoints <= 0) {
    alert("Please fill in all fields with valid values");
    return;
  }

  if (campaignPoints > points) {
    alert("Not enough points. Please earn more points.");
    return;
  }

  // Deduct points
  points -= campaignPoints;
  await set(ref(db, "users/" + user.uid + "/points"), points);
  document.getElementById("points").innerText = points;

  const campaign = {
    name,
    url,
    points: campaignPoints,
    status: "Pending",
    createdAt: new Date().toISOString()
  };

  const campaignRef = push(ref(db, "users/" + user.uid + "/freeCampaigns"));
  await set(campaignRef, campaign);

  alert("Free campaign added!");
  document.getElementById("freeCampaignName").value = "";
  document.getElementById("freeCampaignUrl").value = "";
  document.getElementById("freeCampaignPoints").value = "";

  loadFreeCampaigns();
}


    async function loadFreeCampaigns() {
  const campaignsRef = ref(db, "users/" + user.uid + "/freeCampaigns");
  const snapshot = await get(campaignsRef);
  const table = document.getElementById("freeCampaignTable");
  table.innerHTML = "";

  if (!snapshot.exists()) {
    table.innerHTML = "<tr><td colspan='4' class='text-center py-4 text-gray-400'>No free campaigns yet.</td></tr>";
    return;
  }

  const campaigns = snapshot.val();
  for (const key in campaigns) {
    const c = campaigns[key];
    const row = document.createElement("tr");
    row.className = "border-b border-gray-700";
    row.innerHTML = `
      <td class="py-2 px-4">${c.name}</td>
      <td class="py-2 px-4">${c.url}</td>
      <td class="py-2 px-4">${c.points}</td>
      <td class="py-2 px-4">${c.status}</td>
    `;
    table.appendChild(row);
  }
}


    function earnPoints() {
      points += 10;
      set(ref(db, "users/" + user.uid + "/points"), points);
      document.getElementById("points").innerText = points;
      alert("You earned 10 points!");
    }

    function updateStatus(campaignId, newStatus) {
      update(ref(db, "users/" + user.uid + "/campaigns/" + campaignId), { status: newStatus });
      loadCampaigns();
    }

    function logout() {
      localStorage.removeItem("boostifyUser");
      window.location.href = "login.html";
    }

    window.updateStatus = updateStatus;
    window.depositFunds = depositFunds;
    window.createCampaign = createCampaign;
    window.createFreeCampaign = createFreeCampaign;
    window.earnPoints = earnPoints;
    window.logout = logout;

    window.addEventListener("DOMContentLoaded", loadDashboard);
  </script>
</head>
<body class="bg-gradient-to-br from-gray-900 via-black to-gray-800 text-white min-h-screen flex flex-col">

  

  <!-- Nav -->
  <nav class="flex justify-between items-center px-8 py-4 bg-black/30 backdrop-blur-md">
    <h1 class="text-2xl font-bold text-blue-400">Boostify Dashboard</h1>
    <div class="flex items-center space-x-6">
      <p>Welcome, <span id="username"></span></p>
      <p id="headerBalance">Balance: $<span id="balance">0.00</span></p>
      <p id="headerPoints" class="hidden">Points: <span id="points">0</span></p>
      <button onclick="logout()" class="px-4 py-2 rounded-lg bg-red-500 hover:bg-red-600 transition">Logout</button>
    </div>
  </nav>


  <!-- Logo and Toggle Buttons -->
  <div class="flex flex-col items-center py-4 space-y-4 bg-black/20">
    <div class="space-x-4">
      <button onclick="document.getElementById('paidContainer').classList.remove('hidden'); document.getElementById('freeContainer').classList.add('hidden'); document.getElementById('headerBalance').classList.remove('hidden'); document.getElementById('headerPoints').classList.add('hidden');"
        class="px-6 py-2 bg-blue-500 rounded-lg font-semibold">Paid</button>
      <button onclick="document.getElementById('freeContainer').classList.remove('hidden'); document.getElementById('paidContainer').classList.add('hidden'); document.getElementById('headerPoints').classList.remove('hidden'); document.getElementById('headerBalance').classList.add('hidden');"
        class="px-6 py-2 bg-green-500 rounded-lg font-semibold">Free</button>
    </div>
  </div>


  <!-- Paid Container -->
  <main id="paidContainer" class="flex-1 px-6 py-8 space-y-8 max-w-5xl mx-auto">
    <!-- Deposit Section -->
    <section class="bg-gray-800 p-6 rounded-2xl shadow-lg">
      <h2 class="text-xl font-semibold mb-4">Deposit Funds</h2>
      <div class="flex space-x-4">
        <input id="depositAmount" type="number" placeholder="Amount in USD" class="flex-1 px-4 py-2 rounded-lg bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
        <button onclick="depositFunds()" class="px-6 py-2 bg-blue-500 hover:bg-blue-600 rounded-lg font-semibold">Deposit</button>
      </div>
    </section>

    <!-- Create Campaign Section -->
    <section class="bg-gray-800 p-6 rounded-2xl shadow-lg">
      <h2 class="text-xl font-semibold mb-4">Create Campaign</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <input id="campaignName" type="text" placeholder="Campaign Name" class="px-4 py-2 rounded-lg bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
        <input id="campaignUrl" type="url" placeholder="Target URL" class="px-4 py-2 rounded-lg bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
        <input id="campaignBudget" type="number" placeholder="Budget (USD)" class="px-4 py-2 rounded-lg bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
      </div>
      <button onclick="createCampaign()" class="mt-4 px-6 py-2 bg-green-500 hover:bg-green-600 rounded-lg font-semibold">Create Campaign</button>
    </section>

    <!-- Campaigns List -->
    <section class="bg-gray-800 p-6 rounded-2xl shadow-lg">
      <h2 class="text-xl font-semibold mb-4">Your Campaigns</h2>
      <table class="w-full text-left">
        <thead>
          <tr class="border-b border-gray-700">
            <th class="py-2 px-4">Name</th>
            <th class="py-2 px-4">URL</th>
            <th class="py-2 px-4">Budget</th>
            <th class="py-2 px-4">Status</th>
            <th class="py-2 px-4">Actions</th>
          </tr>
        </thead>
        <tbody id="campaignTable"></tbody>
      </table>
    </section>
  </main>

 <main id="freeContainer" class="hidden flex-1 px-6 py-8 space-y-8 max-w-5xl mx-auto">
  <!-- Add Free Campaign -->
  <section class="bg-gray-800 p-6 rounded-2xl shadow-lg">
    <h2 class="text-xl font-semibold mb-4">Add Free Campaign</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <input id="freeCampaignName" type="text" placeholder="Campaign Name"
             class="px-4 py-2 rounded-lg bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-green-500">
      <input id="freeCampaignUrl" type="url" placeholder="Target URL"
             class="px-4 py-2 rounded-lg bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-green-500">
      <input id="freeCampaignPoints" type="number" placeholder="Points"
             class="px-4 py-2 rounded-lg bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-green-500">
    </div>
    <button onclick="createFreeCampaign()" class="mt-4 px-6 py-2 bg-green-500 hover:bg-green-600 rounded-lg font-semibold">Add Campaign</button>
  </section>

  <!-- Free Campaigns List -->
  <section class="bg-gray-800 p-6 rounded-2xl shadow-lg">
    <h2 class="text-xl font-semibold mb-4">Your Free Campaigns</h2>
    <table class="w-full text-left">
      <thead>
        <tr class="border-b border-gray-700">
          <th class="py-2 px-4">Name</th>
          <th class="py-2 px-4">URL</th>
          <th class="py-2 px-4">Points</th>
          <th class="py-2 px-4">Status</th>
        </tr>
      </thead>
      <tbody id="freeCampaignTable"></tbody>
    </table>
  </section>

  <!-- Earn Points Button -->
  <section class="text-center">
    <button onclick="earnPoints()" class="px-8 py-3 bg-yellow-500 hover:bg-yellow-600 rounded-lg font-bold text-black">
      Earn Points
    </button>
  </section>
</main>

</body>
</html>
